{"openapi":"3.1.0","info":{"title":"Diagnosis Service API","description":"\n# Hydraulic Diagnosis Orchestration Service\n\nОркестрирует полный пайплайн диагностики:\n1. Сбор sensor data из TimescaleDB\n2. GNN inference\n3. RAG interpretation\n4. Результаты + рекомендации\n\n## Features\n- ✅ Full diagnosis pipeline\n- ✅ Batch processing\n- ✅ Real-time progress tracking\n- ✅ Historical data analysis\n- ✅ WebSocket updates\n\n## Authentication\nRequires JWT Bearer token.\n        ","version":"1.0.0"},"servers":[{"url":"https://api.hydraulic-diagnostics.com/v1/diagnosis","description":"Production"},{"url":"http://localhost:8003","description":"Development"}],"paths":{"/health":{"get":{"tags":["Monitoring"],"summary":"Health Check","description":"Health check для diagnosis orchestrator.\n\nChecks:\n- TimescaleDB connection\n- GNN Service availability\n- RAG Service availability\n- Redis/Celery","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/metrics":{"get":{"tags":["Monitoring"],"summary":"Metrics","description":"Prometheus metrics.\n\n**Diagnosis-specific metrics**:\n- Total diagnoses run\n- Average diagnosis time\n- Success/failure rates\n- Queue length","operationId":"metrics_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/ready":{"get":{"tags":["Monitoring"],"summary":"Readiness Check","description":"Readiness probe.","operationId":"readiness_check_ready_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/diagnosis":{"post":{"tags":["Diagnosis"],"summary":"Run Diagnosis","description":"Start full diagnosis pipeline.\n\n**Process**:\n1. Query sensor data from TimescaleDB\n2. Call GNN Service for inference\n3. Call RAG Service for interpretation\n4. Store results\n\n**Returns**: Diagnosis ID (poll /diagnosis/{id} for results)\n\n**Latency**: 5-10 seconds total (async)","operationId":"run_diagnosis_diagnosis_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DiagnosisRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DiagnosisResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/diagnosis/{diagnosis_id}":{"get":{"tags":["Diagnosis"],"summary":"Get Diagnosis","description":"Get diagnosis results.\n\n**Poll this endpoint** for async results.","operationId":"get_diagnosis_diagnosis__diagnosis_id__get","parameters":[{"name":"diagnosis_id","in":"path","required":true,"schema":{"type":"string","title":"Diagnosis Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DiagnosisResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/diagnosis/{diagnosis_id}/progress":{"get":{"tags":["Diagnosis"],"summary":"Get Diagnosis Progress","description":"Get real-time diagnosis progress.\n\n**Use case**: WebSocket alternative for progress tracking.","operationId":"get_diagnosis_progress_diagnosis__diagnosis_id__progress_get","parameters":[{"name":"diagnosis_id","in":"path","required":true,"schema":{"type":"string","title":"Diagnosis Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/diagnosis/batch":{"post":{"tags":["Diagnosis"],"summary":"Batch Diagnosis","description":"Batch diagnosis for multiple equipment.\n\n**Max**: 50 per batch","operationId":"batch_diagnosis_diagnosis_batch_post","requestBody":{"content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/DiagnosisRequest"},"type":"array","title":"Requests"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"tags":["Info"],"summary":"Root","description":"Root endpoint.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"DiagnosisRequest":{"properties":{"equipment_id":{"type":"string","title":"Equipment Id","description":"Equipment to diagnose"},"time_window":{"$ref":"#/components/schemas/TimeWindow"},"include_rag":{"type":"boolean","title":"Include Rag","description":"Include RAG interpretation","default":true}},"type":"object","required":["equipment_id","time_window"],"title":"DiagnosisRequest","description":"Diagnosis request.","example":{"equipment_id":"exc_001","include_rag":true,"time_window":{"end_time":"2025-11-13T00:00:00Z","start_time":"2025-11-01T00:00:00Z"}}},"DiagnosisResponse":{"properties":{"diagnosis_id":{"type":"string","title":"Diagnosis Id"},"equipment_id":{"type":"string","title":"Equipment Id"},"status":{"type":"string","title":"Status"},"gnn_result":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Gnn Result"},"rag_interpretation":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Rag Interpretation"},"created_at":{"type":"string","title":"Created At"},"completed_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Completed At"},"progress":{"type":"number","maximum":100.0,"minimum":0.0,"title":"Progress","default":0.0}},"type":"object","required":["diagnosis_id","equipment_id","status","created_at"],"title":"DiagnosisResponse","description":"Complete diagnosis result."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"TimeWindow":{"properties":{"start_time":{"type":"string","title":"Start Time","description":"ISO 8601 timestamp"},"end_time":{"type":"string","title":"End Time","description":"ISO 8601 timestamp"}},"type":"object","required":["start_time","end_time"],"title":"TimeWindow","description":"Time range for diagnosis."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}}},"security":[{"bearerAuth":[]}],"tags":[{"name":"Diagnosis","description":"Diagnosis operations"},{"name":"Monitoring","description":"Health and metrics"}]}