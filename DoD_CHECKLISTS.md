# DoD Checklists per Roadmap Stage

Ниже критерии приемки (Definition of Done) для каждого этапа из ROADMAP_INCREMENTAL.md. Каждый пункт обязателен.

## Этап 0. Базовая среда и наблюдаемость
- Проект стартует локально одной командой (docker compose up / npm run dev + backend).
- Логи фронта/бэка читаемы, ошибки в dev-окружении видны в консоли.
- Локальные переменные окружения задокументированы, секреты вне репозитория.
- Pre-commit проходит на чистой ветке, линтеры без ошибок.

## Этап 1. Аутентификация
- Вход/выход работает через реальные API; приватные страницы закрыты без токена.
- JWT refresh работает; просроченный токен корректно обновляется/обнуляется.
- Роли применяются на API и в UI; попытки доступа логируются.
- Unit-тесты users (≥90% критических путей), негативные кейсы (lockout).

## Этап 2. Дашборд метрики
- KPI на фронте приходят с бэкенда, кэш Redis активен (TTL виден по логам/метрикам).
- Контракты API описаны (OpenAPI), добавлены e2e тесты отображения KPI.
- Метрики latency/error-rate собраны, алерты dev уровня настроены.

## Этап 3. Diagnostics MVP
- Диагностика запускается, меняет статусы, завершаетcя; прогресс в UI real‑time.
- Отмена задач корректно останавливает обработку; отсутствуют зомби-задачи.
- Логи Celery/Channels структурированы; ретраи отражаются метриками.
- Интеграционные тесты: запуск/прогресс/завершение/отмена.

## Этап 4. Сенсорные данные (ingest + таблица)
- Загрузка CSV валидируется, плохие строки протоколируются, quarantine работает.
- Таблица на фронте листает и фильтрует реальные данные с пагинацией.
- БД имеет индекс(ы) по времени/оборудованию; планы запросов проверены.
- Тесты на валидацию CSV, производительность чтения (порог p95 оговорен).

## Этап 5. Графики и агрегации
- Графики строятся из TimescaleDB с агрегациями; нет N+1 запросов.
- Downsampling активен для больших диапазонов; кэш на эндпоинтах графиков.
- UI поддерживает zoom/pan и пустые состояния без ошибок.
- Нагрузочный тест эндпоинтов графиков с отчетом p95/p99.

## Этап 6. Отчеты PDF
- Генерация PDF стабильна, файлы хранятся в объектном сторе, ссылки подписаны.
- Шаблоны брендированы, локаль учитывается; номера страниц и оглавление есть.
- История отчетов и доступы контролируются; аудит скачиваний включен.
- Тесты рендеринга PDF (заглушки), e2e генерация + скачивание.

## Этап 7. Alerts/Thresholds
- CRUD порогов работает, двигатель триггеров учитывает гистерезис.
- Алерты не «флапают» при шуме; acknowledge отражается в UI и БД.
- Нотификации отправляются (dev-заглушки/интеграции), есть ретраи.
- Тесты правил, подавления и эскалаций.

## Этап 8. RAG Assistant (минимум)
- Индексация документов, поиск top‑k, ответы с указанием источников.
- Ограничение контекста, логирование токенов/стоимости; защита от prompt‑инъекций.
- Экспорт диалога в Markdown; права доступа к документам применяются.
- Интеграционный тест пайплайна RAG.

## Этап 9. Интеграции
- Подключение SCADA/ERP через адаптеры с health‑check; конфиги безопасны.
- Рейт‑лимиты/ретраи применяются; вебхуки обрабатываются идемпотентно.
- UI показывает статус интеграций и ошибки подключения.
- Контракт интеграций документирован, тесты контрактов.

## Этап 10. Prod hardening
- MFA включена, audit trail покрывает критичные действия, PII шифруется на хранении.
- Метрики/трейсы/логи собираются; дашборды/алерты SLO работают.
- Профилирование: горячие эндпоинты ускорены, индексы добавлены.
- CI/CD поддерживает blue‑green/canary; rollback сценарии задокументированы.
