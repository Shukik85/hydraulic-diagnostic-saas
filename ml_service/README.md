# üöÄ ML Inference –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å

**Enterprise –≥–∏–¥—Ä–∞–≤–ª–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å CatBoost anomaly detection**

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Primary Model: CatBoost** - –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–Ω–æ–º–∞–ª–∏–π
- **Fallback Strategy** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- **Real UCI Data Tested** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **FastAPI Async** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - TTL 5 –º–∏–Ω—É—Ç
- **Prometheus –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìä –¢–µ–∫—É—â–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### ‚úÖ –ß—Ç–æ –†–ê–ë–û–¢–ê–ï–¢:
- **CatBoost Model** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
- **UCI Test Suite** - 100% success rate –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **API Endpoints** - /predict, /health, /ready, /metrics
- **Caching** - Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **Monitoring** - –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚ö†Ô∏è –ß—Ç–æ –≤ –†–ê–ó–†–ê–ë–û–¢–ö–ï:
- **XGBoost, RandomForest** - –∑–∞–≥–ª—É—à–∫–∏, –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- **Adaptive Threshold** - –∑–∞–≥–ª—É—à–∫–∞, –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **Ensemble Logic** - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### ‚ùå –ß—Ç–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
- **99.99% AUC** - –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- **<100ms latency** - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ ~1100ms –≤ —Ç–µ—Å—Ç–∞—Ö
- **4 –º–æ–¥–µ–ª–∏ ensemble** - —Ç–æ–ª—å–∫–æ CatBoost —Ä–µ–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
cd ml_service
pip install -r requirements.txt
cp .env.example .env
```

### 2. –ó–∞–ø—É—Å–∫
```bash
# Development
python main.py

# Production
uvicorn main:app --host 0.0.0.0 --port 8001
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
# Health check
curl http://localhost:8001/health

# Service info
curl http://localhost:8001/info
```

## üì° API Endpoints

### –ë–∞–∑–æ–≤—ã–µ
- `GET /` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /ready` - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ
- `GET /metrics` - Prometheus –º–µ—Ç—Ä–∏–∫–∏

### ML Inference
- `POST /api/v1/predict` - –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
- `GET /api/v1/models/status` - –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–µ–π

## üß™ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
import httpx

async def predict_anomaly():
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "http://localhost:8001/api/v1/predict",
            json={
                "sensor_data": {
                    "system_id": "test-system",
                    "readings": [
                        {"sensor_type": "pressure", "value": 150.5},
                        {"sensor_type": "temperature", "value": 85.2}
                    ]
                }
            }
        )
        return response.json()
```

## üìä –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º UCI —Ç–µ—Å—Ç–æ–≤:**
- **Latency**: ~1100ms p50 (target: <100ms) ‚ùå
- **Success Rate**: 100% –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- **Models Loaded**: 1 (CatBoost only) ‚ö†Ô∏è
- **Cache Hit Rate**: 90%+ –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ–≤–∞ ‚úÖ

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ config.py:
```python
ensemble_weights = [0.5, 0.3, 0.15, 0.05]  # –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
prediction_threshold = 0.6
max_inference_time_ms = 20  # –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ ~1100ms
```

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

1. **–í—ã—Å–æ–∫–∞—è Latency** - —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ inference pipeline
2. **–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ú–æ–¥–µ–ª—å** - —Ç–æ–ª—å–∫–æ CatBoost —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **Misleading Metrics** - –º–Ω–æ–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–¥–µ –Ω–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å
4. **Feature Engineering** - –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –Ω—É–∂–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞

## üéØ Roadmap –¥–æ Production

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ó–∞–¥–∞—á–∏:
1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Latency** - —Ü–µ–ª—å <100ms
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è XGBoost/RandomForest** - –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≥–ª—É—à–µ–∫
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ú–µ—Ç—Ä–∏–∫** - —É–±—Ä–∞—Ç—å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã
4. **Feature Pipeline** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Ä–µ–∞–ª—å–Ω—ã–µ SLA –º–µ—Ç—Ä–∏–∫–∏

### Nice-to-have:
- –†–µ–∞–ª—å–Ω–∞—è ensemble —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
ml_service/
‚îú‚îÄ‚îÄ main.py              # FastAPI app
‚îú‚îÄ‚îÄ config.py            # Settings (—á–∞—Å—Ç–∏—á–Ω–æ —É—Å—Ç–∞—Ä–µ–ª–∏)
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ catboost_model.py    # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ ensemble.py          # ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ base_model.py        # ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ routes.py            # ‚úÖ API endpoints
‚îî‚îÄ‚îÄ tests/                   # ‚ùì –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

---

**‚ö†Ô∏è –í–ê–ñ–ù–û: –î–∞–Ω–Ω—ã–π README –æ—Ç—Ä–∞–∂–∞–µ—Ç –§–ê–ö–¢–ò–ß–ï–°–ö–û–ï —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–æ—è–±—Ä—å 2025.**

**–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –æ 99.99% AUC –∏ 4 –º–æ–¥–µ–ª—è—Ö –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.**
